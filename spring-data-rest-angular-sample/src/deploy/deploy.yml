

- name: install center env
  hosts: center
  become: yes
  environment:  
    ANSIBLE_CONSUL_URL: "http://139.196.48.143:8500"
  vars:
    consul_kv_result: "{{ lookup('consul_kv','service/node/version/started','http://139.196.48.143:8500') }}"


  tasks:  
#    - name: Copy files to deploy dir
#      synchronize : src="files/" dest="deploy"
  - name: add a node to an  group via consul inventory
    consul_kv:
      host: "139.196.48.143"
      port: "8500"
      key: "service/node/version/started"
      value: "{{ project_release_no }}"


  - debug: msg='key contains {{item}}'
    delegate_to: localhost
    with_consul_kv:
      - 'service/node/version/started'
    environment:  
      ANSIBLE_CONSUL_URL: "http://139.196.48.143:8500"

  - name: Copy files to deploy dir 
    debug: msg="{{ consul_kv_result }}"
    environment:  
      ANSIBLE_CONSUL_URL: "http://139.196.48.143:8500"